# 長篇小說結果聚合技能

## 核心理念
將多段獨立分析結果合併為完整、連貫的番劇規劃。

## 聚合流程

### 第一步：角色合併
```
段落1角色: [張三(主), 李四(配), 王五(配)]
段落2角色: [張三(主), 李四(配), 趙六(新)]
段落3角色: [張三(主), 王五(配), 趙六(配), 孫七(新)]

合併結果:
- 主角: 張三 (出場率100%)
- 重要配角: 李四(67%), 王五(67%), 趙六(67%)
- 次要配角: 孫七(33%)
```

### 第二步：場景合併
```
所有段落場景去重:
- 小鎮 (出現12次) → 主要場景
- 京城 (出現8次) → 主要場景
- 深山 (出現3次) → 次要場景
```

### 第三步：事件時間線
```
段落1: [事件A] → [事件B]
段落2: [事件C] → [事件D]
段落3: [事件E] → [事件F]

完整時間線:
A → B → C → D → E → F
     ↓       ↓
   轉折1   高潮
```

### 第四步：情緒總弧線
```
段落情緒: [平靜→緊張] [緊張→絕望] [絕望→希望] [希望→勝利]

總弧線: 平靜 ━━━━╱緊張━━━╲絕望━━━╱希望━━━━╱勝利
        ↑開端    ↑發展    ↑低谷    ↑高潮  ↑結局
```

## 集數分配算法

### 基於內容密度
```python
def allocate_episodes(chunks):
    total_weight = sum(c.importance * c.wordCount for c in chunks)
    for chunk in chunks:
        chunk.episodes = round(
            (chunk.importance * chunk.wordCount / total_weight) * target_episodes
        )
    return chunks
```

### 敘事階段配比
| 階段 | 佔比 | 10集 | 30集 | 50集 |
|------|------|------|------|------|
| 起 | 15% | 1-2集 | 1-5集 | 1-8集 |
| 承 | 35% | 3-5集 | 6-15集 | 9-25集 |
| 轉 | 35% | 6-8集 | 16-25集 | 26-42集 |
| 合 | 15% | 9-10集 | 26-30集 | 43-50集 |

## 衝突線追蹤

### 主線衝突
```
開始段落: 1  | 揭示: 「主角與父親的隔閡」
發展段落: 3,5,7  | 升級: 「發現父親的秘密」
高潮段落: 10  | 爆發: 「父子對決」
解決段落: 12  | 和解: 「理解與原諒」
```

### 副線衝突
```
副線A: 愛情線 | 段落2-8 | 配角李四的感情
副線B: 事業線 | 段落4-11 | 主角的商業挑戰
```

## 質量檢查

### 連貫性檢查
- [ ] 所有角色有明確出場和退場
- [ ] 所有伏筆都有收束
- [ ] 情緒弧線符合敘事邏輯
- [ ] 集數分配符合節奏需求

### 缺失檢測
- [ ] 有無角色突然消失
- [ ] 有無事件沒有後續
- [ ] 有無情緒斷層
- [ ] 有無節奏失衡

## 最終輸出格式

```json
{
  "totalEpisodes": 30,
  "totalRuntime": "450分鐘",
  "structure": {
    "起": {"episodes": [1,2,3,4,5], "focus": "世界觀建立"},
    "承": {"episodes": [6,7,8,9,10,11,12,13,14,15], "focus": "衝突升級"},
    "轉": {"episodes": [16,17,18,19,20,21,22,23,24,25], "focus": "高潮決戰"},
    "合": {"episodes": [26,27,28,29,30], "focus": "收尾餘韻"}
  },
  "characters": {
    "protagonist": [{"name": "張三", "arc": "從懦弱到勇敢"}],
    "supporting": [{"name": "李四", "arc": "從敵人到盟友"}],
    "antagonist": [{"name": "王五", "arc": "從隱藏到暴露"}]
  },
  "mainPlot": {
    "conflict": "主角對抗腐敗組織",
    "resolution": "揭露真相，重建秩序"
  },
  "subPlots": [
    {"name": "愛情線", "episodes": [3,5,8,12,20,28]}
  ],
  "keyEpisodes": {
    "pilot": 1,
    "midpoint": 15,
    "climax": 25,
    "finale": 30
  },
  "visualThemes": ["暗色調", "城市景觀", "雨夜場景"],
  "emotionalJourney": "從絕望到希望的救贖之旅"
}
```
