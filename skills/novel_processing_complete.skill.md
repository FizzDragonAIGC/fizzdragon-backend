# 長篇小說處理完整技能 (Novel Processing Complete)

> 📚 **融合小說分析全流程**
> - 結構分析 → 分段處理 → 採樣預覽 → 結果聚合

---

## 一、結構識別

### 章節標記識別
```regex
第[一二三四五六七八九十百千\d]+[章節回卷部篇]
Chapter \d+  |  Part \d+  |  卷[一二三四五六七八九十\d]+
```

### 結構層級
| 層級 | 說明 | 映射 |
|------|------|------|
| 部(Part) | 最大敘事單元 | 對應季 |
| 卷(Volume) | 次級單元 | 對應季 |
| 章(Chapter) | 基本敘事單元 | 1-3章=1集 |
| 節(Section) | 場景級別 | 分鏡單元 |

### 敘事弧線定位
| 階段 | 位置 | 功能 |
|------|------|------|
| 開端 | 前15-20% | 世界觀、角色出場 |
| 發展 | 20-50% | 衝突升級、關係深化 |
| 高潮 | 50-75% | 主要衝突爆發 |
| 結局 | 75-100% | 收尾、餘韻 |

---

## 二、分段策略

### 分段原則
1. **尊重章節邊界**：不在章節中間切斷
2. **控制段落大小**：每段6000-10000字
3. **保持上下文**：段落間200字重疊
4. **標記連續性**：記錄跨段角色和線索

### 分段大小建議
| 小說類型 | 建議段落 | 原因 |
|----------|----------|------|
| 對話密集 | 8000字 | 信息密度低 |
| 描寫密集 | 6000字 | 信息密度高 |
| 動作密集 | 10000字 | 需完整場景 |
| 心理描寫 | 5000字 | 需細緻分析 |

---

## 三、快速預覽採樣

### 三點採樣法
```
1. 開頭採樣 (前5000字)
   - 世界觀建立、主角出場、敘事風格

2. 中間採樣 (50%位置±3000字)
   - 故事發展、關鍵轉折、角色成長

3. 結尾採樣 (最後5000字)
   - 結局走向、主題呈現、情感收尾
```

### 採樣分析維度
- 敘事人稱（第一/第三）
- 時間線結構（線性/倒敘/多線）
- 語言風格（古典/現代/口語）
- 情感基調（悲劇/喜劇/混合）

---

## 四、單段分析

### 必須提取
| 維度 | 內容 |
|------|------|
| **角色** | 出場列表、新登場(🆕)、關係變化 |
| **場景** | 地點、時間、氛圍 |
| **事件** | 推動劇情、揭示信息、情感轉折 |
| **對話** | 關鍵對話(≤5組)、潛台詞 |
| **情緒** | 開始→結束、轉折點 |

### 連續性追蹤
```json
{
  "carryOver": {
    "unresolvedConflicts": ["衝突1仍在發展"],
    "activeCharacters": ["角色A", "角色B"],
    "pendingPlots": ["伏筆X待揭曉"],
    "emotionalState": "緊張升級中"
  }
}
```

---

## 五、結果聚合

### 角色合併
```
段落1: [張三(主), 李四(配)]
段落2: [張三(主), 王五(新)]
段落3: [張三(主), 李四(配), 王五(配)]

合併結果:
- 主角: 張三 (100%)
- 重要配角: 李四(67%), 王五(67%)
```

### 場景合併
- 合併相同地點的場景
- 標記場景出現頻率
- 識別核心vs次要場景

### 事件時間線
```
時間軸:
1 → 事件A (激勵)
2 → 事件B (發展)
5 → 事件C (轉折) ← 標記重要
8 → 事件D (高潮) ← 標記重要
10 → 事件E (結局)
```

---

## 六、分集映射

### 字數→集數公式
```
小說字數 / 15,000 = 基礎集數 (每集10-15分鐘)

調整係數:
- 對話密集 → +15%
- 動作密集 → +20%
- 內心描寫 → -10%
- 敘述密集 → -15%
```

### 章節映射策略
| 章節類型 | 映射 |
|----------|------|
| 短章節(3000字內) | 合併為1集 |
| 中章節(5000字) | 單獨1集 |
| 長章節(8000字+) | 拆分為2集 |

### 關鍵場景標記
- ⭐ 必須保留（劇情關鍵）
- 🔥 高潮場景（視覺重點）
- 💔 情感場景（表演重點）
- 🎭 對話場景（台詞重點）

---

## 七、輸出格式

```json
{
  "novel_analysis": {
    "totalChapters": 120,
    "totalWords": 300000,
    "structure": {
      "type": "部-章",
      "parts": [
        {"name": "第一部", "chapters": [1,30], "phase": "起"}
      ]
    },
    "suggestedEpisodes": 40,
    "chapterToEpisodeRatio": "3:1"
  },
  "chunks": [
    {
      "chunkId": 1,
      "chapterRange": "1-5",
      "wordCount": 8000,
      "characters": [
        {"name": "張三", "role": "主角", "firstAppearance": true}
      ],
      "scenes": [
        {"location": "小鎮", "time": "清晨", "mood": "平靜"}
      ],
      "keyEvents": [
        {"event": "收到神秘信件", "importance": "高", "type": "inciting"}
      ],
      "emotionalArc": {
        "start": "平靜日常",
        "end": "懸念升起",
        "turning": "打開信件"
      },
      "suggestedEpisodes": [1, 2],
      "carryOver": {
        "unresolvedConflicts": ["信件內容未揭曉"]
      }
    }
  ],
  "aggregated": {
    "mainCharacters": ["張三", "李四"],
    "coreLocations": ["小鎮", "城堡"],
    "timeline": ["事件A", "事件B", "事件C"],
    "themes": ["成長", "復仇"]
  }
}
```
